<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Notifica√ß√£o de Risco</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer"/>

  <style>
    :root{
      --bg1:#0e1a1a;
      --bg2:#0b2a24;
      --bg3:#0a1e2d;
      --primary:#00bfa6;
      --primary-600:#00a892;
      --accent:#ffd166;
      --muted:#b9d9d4;
      --text:#e5f7f4;
      --glass: rgba(255,255,255,.06);
      --borderC: rgba(255,255,255,.14);
      --radius:18px;
      --shadow: 0 8px 30px rgba(0,0,0,.35);
      --ring: 0 10px 30px rgba(0,191,166,.25);
      --transition: .35s cubic-bezier(.2,.8,.2,1);
      --input-bg: rgba(12,20,28,.55);
      --input-bd: rgba(255,255,255,.14);
      --input-ph: #9fc9c3;
      --danger: #ff6b6b;
      --success: #1dd1a1;
    }

    *,*:before,*:after{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 800px at 10% -10%, #0f3d3a55, transparent 60%),
                  radial-gradient(1000px 800px at 110% 10%, #0a2f4850, transparent 60%),
                  linear-gradient(120deg, var(--bg1), var(--bg2) 55%, var(--bg3));
      overflow-x:hidden;
    }

    .ambient{
      position: fixed; inset: -20vmax; pointer-events:none; z-index:0;
      background:
        radial-gradient(35vmax 35vmax at 20% 20%, rgba(0,191,166,.12), transparent 60%),
        radial-gradient(40vmax 40vmax at 80% 10%, rgba(64,188,255,.10), transparent 65%),
        radial-gradient(30vmax 30vmax at 50% 90%, rgba(255,209,102,.10), transparent 70%);
      filter: blur(30px) saturate(120%);
      animation: float 18s ease-in-out infinite alternate;
    }
    @keyframes float{ 0%{ transform: translate3d(0,0,0) scale(1);} 100%{ transform: translate3d(2%,-1%,0) scale(1.03);} }

    header{
      position:sticky; top:0; z-index:5;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(8,15,23,.7), rgba(8,15,23,.35) 60%, transparent);
      border-bottom: 1px solid var(--borderC);
    }
    .header-wrap{
      max-width:1100px; margin:0 auto;
      padding: 1rem clamp(1rem,3vw,1.5rem);
      display:flex; align-items:center; justify-content:space-between; gap:1rem;
    }
    .brand{ display:flex; align-items:center; gap:.8rem; color:var(--text); text-decoration:none; }
    .logo{
      width:42px; height:42px; border-radius:14px; position:relative; overflow:hidden;
      background: conic-gradient(from 200deg at 50% 50%, #00bfa6, #40bcff, #ffd166, #00bfa6);
      box-shadow: inset 0 0 0 3px rgba(0,0,0,.35), 0 10px 25px rgba(0,0,0,.3);
      display:grid; place-items:center;
    }
    .logo::after{ content:""; position:absolute; inset:2px; border-radius:12px;
      background:linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.55)); }
    .logo i{ position:relative; z-index:1; color:#eafffb; }
    .title{ font-weight:800; letter-spacing:.2px; line-height:1.1; }
    .subtitle{ font-size:.9rem; color:var(--muted); }

    .container{
      position:relative; z-index:1;
      max-width:900px;
      margin: clamp(1rem,3vw,2rem) auto;
      padding: 0 clamp(1rem,3vw,1.5rem) 2rem;
    }

    .back-container{ margin-bottom:1rem; }
    .btn-back{
      display:inline-flex; align-items:center; gap:.6rem;
      padding:.7rem 1rem; border-radius:12px;
      text-decoration:none; color:#041311; font-weight:700;
      background: linear-gradient(135deg, var(--primary), #40bcff);
      box-shadow: inset 0 -2px 0 rgba(0,0,0,.2), 0 8px 16px rgba(0,191,166,.25);
      transition: transform var(--transition), box-shadow var(--transition), filter var(--transition);
    }
    .btn-back:hover{ transform:translateY(-2px); box-shadow: 0 14px 28px rgba(0,191,166,.35); filter:saturate(110%); }

    .form-card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border:1px solid var(--borderC);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(1rem, 3vw, 1.5rem);
    }

    h1{
      margin:0 0 .75rem 0;
      font-size: clamp(1.25rem, 1rem + 1.2vw, 1.8rem);
      font-weight:800;
      letter-spacing:.2px;
    }
    .form-sub{ margin:0 0 1rem 0; color:var(--muted); }

    .grid{ display:grid; gap:1rem; }
    @media(min-width:720px){
      .grid-2{ grid-template-columns: 1fr 1fr; }
      .grid-3{ grid-template-columns: 1fr 1fr 1fr; }
    }

    .field{ display:flex; flex-direction:column; gap:.45rem; }
    label{ font-weight:700; font-size:.95rem; letter-spacing:.15px; }
    .input{
      display:flex; align-items:center; gap:.6rem;
      background: var(--input-bg);
      border:1px solid var(--input-bd);
      border-radius:14px;
      padding:.8rem .9rem;
      transition: border-color var(--transition), box-shadow var(--transition), transform var(--transition);
    }
    .input select option { color: #000; background-color: #fff; }

    .input input[type="text"],
    .input input[type="date"],
    .input select,
    .input textarea{
      width:100%; background:transparent; border:none; outline:none; color:var(--text);
      font-size:1rem;
    }
    .input textarea{ resize: vertical; min-height: 84px; }
    .input ::placeholder{ color: var(--input-ph); }

    /* üî¥ Estilo de campo inv√°lido (valida√ß√£o em tempo real) */
    .input.input-error{
      border-color: var(--danger);
      box-shadow: 0 0 0 1px rgba(255,107,107,.4);
    }

    .dropzone{
      position:relative; border:1px dashed rgba(255,255,255,.25);
      background: linear-gradient(180deg, rgba(0,191,166,.06), rgba(64,188,255,.05));
      border-radius:14px; padding:1rem;
      display:flex; align-items:center; gap:.8rem; flex-wrap:wrap;
      transition: border-color var(--transition), background var(--transition);
    }
    .dropzone.dragover{
      border-color: rgba(0,191,166,.8);
      background: linear-gradient(180deg, rgba(0,191,166,.12), rgba(64,188,255,.10));
      box-shadow: var(--ring);
    }
    .dropzone input[type="file"]{ position:absolute; inset:0; opacity:0; cursor:pointer; }
    .file-label{ display:flex; align-items:center; gap:.6rem; font-weight:700; }
    .file-info{ font-size:.9rem; color:var(--muted); }

    .actions{ margin-top:1rem; display:flex; gap:.8rem; flex-wrap:wrap; }
    .btn{
      appearance:none; border:none; cursor:pointer;
      text-decoration:none; color:#041311; font-weight:800;
      background: linear-gradient(135deg, var(--primary), #40bcff);
      padding: .9rem 1.1rem; border-radius:14px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,.2), 0 8px 16px rgba(0,191,166,.25);
      transition: transform var(--transition), box-shadow var(--transition), filter var(--transition);
      display:inline-flex; align-items:center; gap:.6rem; font-size:1rem;
      width:100%;
    }
    .btn:hover{ transform: translateY(-2px); box-shadow: 0 14px 28px rgba(0,191,166,.35); filter:saturate(110%); }
    @media(min-width:520px){ .btn{ width:auto; } }

    .alert{
      position: fixed; right: 1rem; bottom: 1rem; z-index: 10;
      display:flex; align-items:center; gap:.8rem; flex-wrap:wrap;
      padding:.85rem 1rem; border-radius:14px;
      background: linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.55));
      border:1px solid rgba(255,255,255,.18);
      color:#eafffb; box-shadow: var(--shadow);
      transform: translateY(120%); opacity:0; pointer-events:none;
      transition: transform var(--transition), opacity var(--transition);
    }
    .alert.show{ transform: translateY(0); opacity:1; pointer-events:auto; }
    .alert .badge{
      display:inline-flex; align-items:center; gap:.45rem; font-weight:800; padding:.35rem .6rem; border-radius:999px;
      background: linear-gradient(135deg, #0bb37b, #1dd1a1); color:#01251f; border:1px solid rgba(255,255,255,.2);
    }
    .alert a{
      text-decoration:none; font-weight:800; color:#041311; white-space:nowrap;
      background: linear-gradient(135deg, var(--accent), #ffe29f);
      padding:.55rem .75rem; border-radius:10px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,.2);
      transition: transform var(--transition), filter var(--transition);
    }
    .alert a:hover{ transform: translateY(-1px); filter:saturate(110%); }

    .divider{
      height:1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,.18), transparent);
      margin:.4rem 0 1rem;
    }

    :focus-visible{ outline:2px solid #40bcff; outline-offset:2px; border-radius:12px; }

    @media (prefers-reduced-motion: reduce){
      .ambient, .btn, .input, .alert{ transition: none; animation: none; }
    }

    /* üîµ Overlay de envio (bloqueia a tela) */
    .overlay-envio{
      position:fixed;
      inset:0;
      background:rgba(3,7,15,.85);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:20;
    }
    .overlay-envio.show{
      display:flex;
    }
    .overlay-card{
      background:rgba(9,22,30,.95);
      border:1px solid var(--borderC);
      border-radius:16px;
      padding:1.5rem 1.75rem;
      box-shadow:var(--shadow);
      max-width:320px;
      width:100%;
      text-align:left;
    }
    .overlay-title{
      display:flex;
      align-items:center;
      gap:.6rem;
      font-weight:700;
      margin-bottom:.5rem;
    }
    .overlay-title i{
      color:var(--primary);
    }
    .overlay-text{
      font-size:.9rem;
      color:var(--muted);
      margin-bottom:.9rem;
    }
    .progress-wrap{
      width:100%;
      background:rgba(255,255,255,.08);
      border-radius:999px;
      overflow:hidden;
      height:9px;
      margin-bottom:.4rem;
    }
    .progress-bar{
      height:100%;
      width:0%;
      background:linear-gradient(90deg, var(--primary), #40bcff);
      transition:width .15s linear;
    }
    .progress-percent{
      font-size:.8rem;
      color:var(--muted);
      text-align:right;
    }
  </style>
</head>
<body>
  <div class="ambient" aria-hidden="true"></div>

  <header>
    <div class="header-wrap">
      <a class="brand" href="/dashboard.html">
        <div class="logo"><i class="fa-solid fa-shield-heart"></i></div>
        <div>
          <div class="title">Plangecon ‚Ä¢ SESMT</div>
          <div class="subtitle">Notifica√ß√£o de Risco</div>
        </div>
      </a>
    </div>
  </header>

  <main class="container">
    <div class="back-container">
      <a href="/dashboard.html" class="btn-back"><i class="fas fa-arrow-left"></i> Voltar ao Painel Inicial</a>
    </div>

    <section class="form-card" aria-label="Formul√°rio de Notifica√ß√£o">
      <h1>Formul√°rio de Notifica√ß√£o/Interdi√ß√£o</h1>
      <p class="form-sub">Preencha os campos abaixo e <strong>anexe as evid√™ncias fotogr√°ficas (obrigat√≥rio)</strong>.</p>
      <div class="divider"></div>

      <form id="formNotificacao" enctype="multipart/form-data" class="grid">
        <!-- Respons√°veis -->
        <div class="grid grid-2">
          <div class="field">
            <label for="tecnico">T√©cnico Respons√°vel</label>
            <div class="input"><i class="fa-solid fa-user-helmet-safety"></i>
              <select id="tecnico" name="tecnico" required>
                <option value="">Selecione...</option>
                <option>Alvaro Moreira da Costa</option>
                <option>Debora Nascimento de Freitas</option>
                <option>Diego Silva da Silva</option>
                <option>Douglas Leandro Silva Raposo</option>
                <option>Gleiciele Oliveira Rodrigues</option>
                <option>Jailton Pinto Pacheco Larroque</option>
                <option>Marcos Augusto Mendonca Goncalves</option>
                <option>Marinalva dos Santos da Masceno</option>
                <option>Patricia Matias de Albuquerque</option>
                <option>Rafael Silva Sousa</option>
                <option>Thalia Maia Fernandes</option>
                <option>Valmiran Eduardo Cardoso da Silva</option>
                <option>Cirlene Dantas Vieira</option>
                <option>Fernanda Pacheco</option>
              </select>
            </div>
          </div>

          <div class="field">
            <label for="encarregado">Encarregado Respons√°vel</label>
            <div class="input"><i class="fa-solid fa-user-tie"></i>
              <select id="encarregado" name="encarregado" required>
                <option value="">Selecione...</option>
                <option value="Ricardo Pimentel Figueiredo">Ricardo Pimentel Figueiredo(GESTOR)</option>
                <option value="Abel de Oliveira Pereira">Abel de Oliveira Pereira</option>
                <option value="Adailton Maciel Licor">Adailton Maciel Licor</option>
                <option value="Adriano Veloso da Silva">Adriano Veloso da Silva</option>
                <option value="Alvaro Carlos Leles">Alvaro Carlos Leles</option>
                <option value="Antonio Gilson Chaves Santos">Antonio Gilson Chaves Santos</option>
                <option value="Antonio Jhaymes Oliveira Pinho">Antonio Jhaymes Oliveira Pinho</option>
                <option value="Benilson Campelo Costa">Benilson Campelo Costa</option>
                <option value="Carlos Alberto Furtado Lopes">Carlos Alberto Furtado Lopes</option>
                <option value="Dionatan Brito Gon√ßalves">Dionatan Brito Gon√ßalves</option>
                <option value="Douglas da Costa Santos">Douglas da Costa Santos</option>
                <option value="Edilson Dos Santos Ramos">Edilson Dos Santos Ramos</option>
                <option value="Edimar Vieira Candido">Edimar Vieira Candido</option>
                <option value="Erinaldo de Souza Menezes">Erinaldo de Souza Menezes</option>
                <option value="Erisvaldo Ferreira Santos">Erisvaldo Ferreira Santos</option>
                <option value="Felipy de Sousa Sobrinho">Felipy de Sousa Sobrinho</option>
                <option value="Gean de Souza Almeida">Gean de Souza Almeida</option>
                <option value="Gilson Pantoja Teles">Gilson Pantoja Teles</option>
                <option value="Jairo Pereira Ferreira">Jairo Pereira Ferreira</option>
                <option value="Jario de Sousa Oliveira">Jario de Sousa Oliveira</option>
                <option value="Jhemerson Silva e Silva">Jhemerson Silva e Silva</option>
                <option value="Judemberg de Sousa Vieira">Judemberg de Sousa Vieira</option>
                <option value="Junielson Almeida Braga">Junielson Almeida Braga</option>
                <option value="Leandro Silva Barreto">Leandro Silva Barreto</option>
                <option value="Lourifran Pinheiro Moura">Lourifran Pinheiro Moura</option>
                <option value="Miguel Monteles Pedrosa">Miguel Monteles Pedrosa</option>
                <option value="Natanael Pereira Gomes">Natanael Pereira Gomes</option>
                <option value="Ninrody Silva Dutra">Ninrody Silva Dutra</option>
                <option value="Norberto Teixeira Neto">Norberto Teixeira Neto</option>
                <option value="Rosendo Ferreira Campos Neto">Rosendo Ferreira Campos Neto</option>
                <option value="Sadath Oliveira Almeida">Sadath Oliveira Almeida</option>
                <option value="Samuel Lopes Leal">Samuel Lopes Leal</option>
                <option value="Sergio Santos da Costa">Sergio Santos da Costa</option>
                <option value="Silvio Cesar Bezerra Marques">Silvio Cesar Bezerra Marques</option>
                <option value="Thames Patrick da Silva Cardoso">Thames Patrick da Silva Cardoso</option>
                <option value="Thayllison da Silva Cunha">Thayllison da Silva Cunha</option>
                <option value="Valdemir Matos">Valdemir Matos</option>
                <option value="Villian Oliveira da Silva">Villian Oliveira da Silva</option>
                <option value="Wesley Oliveira da Silva">Wesley Oliveira da Silva</option>
              </select>
            </div>
          </div>
        </div>

        <div class="field">
          <label for="supervisor"> Supervisor da Obra</label>
          <div class="input"><i class="fa-solid fa-user-tie"></i>
            <select id="supervisorObra" name="supervisorObra" required>
              <option value="">Selecione...</option>
              <option value="Antonio Carlos Medeiros Barroso">Antonio Carlos Medeiros Barroso</option>
              <option value="Cleudevaldo Costa Silva">Cleudevaldo Costa Silva</option>
              <option value="Evaristo de Oliveira Rabelo">Evaristo de Oliveira Rabelo</option>
              <option value="Gilmar Concei√ßao Silva">Gilmar Concei√ßao Silva</option>
              <option value="Luciano Etelvino Coelho">Luciano Etelvino Coelho</option>
              <option value="Paulo Alessandro de Amorim de Oliveira">Paulo Alessandro de Amorim de Oliveira</option>
              <option value="Paulo Pires Gomes">Paulo Pires Gomes</option>
              <option value="Raimundo Ribeiro Pinheiro">Raimundo Ribeiro Pinheiro</option>
              <option value="Risonildo Amaral Alves">Risonildo Amaral Alves</option>
              <option value="Wesley Kane da Silva Pires">Wesley Kane da Silva Pires</option>
              <option value="Roberval dos Santos">Roberval dos Santos</option>
            </select>
          </div>
        </div>

        <!-- Datas e classifica√ß√£o -->
        <div class="grid grid-3">
          <div class="field">
            <label for="data">Data da Notifica√ß√£o</label>
            <div class="input"><i class="fa-regular fa-calendar-days"></i>
              <input type="date" id="data" name="data" required />
            </div>
          </div>

          <div class="field">
            <label for="classificacao">Classifica√ß√£o</label>
            <div class="input"><i class="fa-solid fa-triangle-exclamation"></i>
              <select id="classificacao" name="classificacao" required>
                <option value="">Selecione</option>
                <option value="Notifica√ß√£o">Notifica√ß√£o</option>
                <option value="Interdi√ß√£o">Interdi√ß√£o</option>
              </select>
            </div>
          </div>

          <div class="field">
            <label for="Squad">Squad</label>
            <div class="input"><i class="fa-solid fa-people-group"></i>
              <select id="Squad" name="Squad" required>
                <option value="">Selecione...</option>
                <option value="USINA I E II">USINA I E II</option>
                <option value="SALOBO III">SALOBO III</option>
                <option value="BRITAGEM">BRITAGEM</option>
                <option value="OFICINA CENTRALIZADA">OFICINA CENTRALIZADA</option>
                <option value="IGB">IGB</option>
                <option value="MINA">MINA</option>
                <option value="BARRAGEM">BARRAGEM</option>
                <option value="PAULO FONTELES">PAULO FONTELES</option>
                <option value="CANTEIRO PLANGECON">CANTEIRO PLANGECON</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Textos -->
        <div class="field">
          <label for="Atividade">Descri√ß√£o da Atividade</label>
          <div class="input"><i class="fa-solid fa-clipboard-list"></i>
            <textarea id="descricaoAtividade" name="descricaoAtividade" rows="2" required placeholder="Ex.: Substitui√ß√£o de correia transportadora, √°rea isolada e sinalizada..."></textarea>
          </div>
        </div>

        <div class="field">
          <label for="descricao">Descri√ß√£o da Condi√ß√£o de Risco</label>
          <div class="input"><i class="fa-solid fa-file-lines"></i>
            <textarea id="descricao" name="descricao" rows="4" required placeholder="Explique o desvio de forma objetiva e com evid√™ncias."></textarea>
          </div>
        </div>

        <div class="field">
          <label for="nr">NR Relacionada</label>
          <div class="input"><i class="fa-solid fa-book-bookmark"></i>
            <select id="nr" name="nr" required>
              <option value="">Selecione...</option>
              <option>NR-1 - DISPOSI√á√ïES GERAIS E GERENCIAMENTO DE RISCOS OCUPACIONAIS</option>
              <option>NR-2 - INSPE√á√ÉO PR√âVIA (REVOGADA)</option>
              <option>NR-3 - EMBARGO E INTERDI√á√ÉO</option>
              <option>NR-4 - SERVI√áOS ESPECIALIZADOS EM SEGURAN√áA E EM MEDICINA DO TRABALHO</option>
              <option>NR-5 - COMISS√ÉO INTERNA DE PREVEN√á√ÉO DE ACIDENTES E DE ASS√âDIO - CIPA</option>
              <option>NR-6 - EQUIPAMENTO DE PROTE√á√ÉO INDIVIDUAL - EPI</option>
              <option>NR-7 - PROGRAMA DE CONTROLE M√âDICO DE SA√öDE OCUPACIONAL</option>
              <option>NR-8 - EDIFICA√á√ïES</option>
              <option>NR-9 - AVALIA√á√ÉO E CONTROLE DAS EXPOSI√á√ïES OCUPACIONAIS A AGENTES F√çSICOS, QU√çMICOS E BIOL√ìGICOS</option>
              <option>NR-10 - SEGURAN√áA EM INSTALA√á√ïES E SERVI√áOS EM ELETRICIDADE</option>
              <option>NR-11 - TRANSPORTE, MOVIMENTA√á√ÉO, ARMAZENAGEM E MANUSEIO DE MATERIAIS</option>
              <option>NR-12 - SEGURAN√áA NO TRABALHO EM M√ÅQUINAS E EQUIPAMENTOS</option>
              <option>NR-13 - CALDEIRAS, VASOS DE PRESS√ÉO E TUBULA√á√ïES E TANQUES MET√ÅLICOS DE ARMAZENAMENTO</option>
              <option>NR-14 - FORNOS</option>
              <option>NR-15 - ATIVIDADES E OPERA√á√ïES INSALUBRES</option>
              <option>NR-16 - ATIVIDADES E OPERA√á√ïES PERIGOSAS</option>
              <option>NR-17 - ERGONOMIA</option>
              <option>NR-18 - SEGURAN√áA E SA√öDE NO TRABALHO NA IND√öSTRIA DA CONSTRU√á√ÉO</option>
              <option>NR-19 - EXPLOSIVOS</option>
              <option>NR-20 - SEGURAN√áA E SA√öDE NO TRABALHO COM INFLAM√ÅVEIS E COMBUST√çVEIS</option>
              <option>NR-21 - TRABALHOS A C√âU ABERTO</option>
              <option>NR-22 - SEGURAN√áA E SA√öDE OCUPACIONAL NA MINERA√á√ÉO</option>
              <option>NR-23 - PROTE√á√ÉO CONTRA INC√äNDIOS</option>
              <option>NR-24 - CONDI√á√ïES SANIT√ÅRIAS E DE CONFORTO NOS LOCAIS DE TRABALHO</option>
              <option>NR-25 - RES√çDUOS INDUSTRIAIS</option>
              <option>NR-26 - SINALIZA√á√ÉO DE SEGURAN√áA</option>
              <option>NR-27 - REGISTRO PROFISSIONAL DO T√âCNICO DE SEGURAN√áA DO TRABALHO (REVOGADA)</option>
              <option>NR-28 - FISCALIZA√á√ÉO E PENALIDADES</option>
              <option>NR-29 - ... PORTU√ÅRIO</option>
              <option>NR-30 - ... AQUAVI√ÅRIO</option>
              <option>NR-31 - ... AGRICULTURA ... AQUICULTURA</option>
              <option>NR-32 - ... SERVI√áOS DE SA√öDE</option>
              <option>NR-33 - ... ESPA√áOS CONFINADOS</option>
              <option>NR-34 - ... NAVAL</option>
              <option>NR-35 - TRABALHO EM ALTURA</option>
              <option>NR-36 - ... CARNES E DERIVADOS</option>
              <option>NR-37 - ... PLATAFORMAS DE PETR√ìLEO</option>
              <option>NR-38 - ... LIMPEZA URBANA E RES√çDUOS S√ìLIDOS</option>
              <option>N/A</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label for="acao">A√ß√µes Recomendadas</label>
          <div class="input"><i class="fa-solid fa-list-check"></i>
            <textarea id="acao" name="acao" rows="3" required placeholder="Indique as a√ß√µes corretivas/preventivas e respons√°veis."></textarea>
          </div>
        </div>

        <div class="grid grid-2">
          <div class="field">
            <label for="prazo">Prazo para Resolu√ß√£o</label>
            <div class="input"><i class="fa-regular fa-clock"></i>
              <input type="date" id="prazo" name="prazo" required />
            </div>
          </div>
          <div class="field">
            <label for="fotos">Evid√™ncia Fotogr√°fica <span aria-hidden="true">(obrigat√≥rio)</span></label>
            <div class="dropzone" id="dropArea">
              <i class="fa-solid fa-cloud-arrow-up" aria-hidden="true"></i>
              <span class="file-label">Selecione ou solte as imagens aqui</span>
              <span class="file-info" id="fileInfo">Nenhum arquivo selecionado</span>
              <input type="file" id="fotos" name="notificacaoFotos" multiple accept="image/*" required />
            </div>
          </div>
        </div>

        <div class="actions">
          <button class="btn" type="submit" id="btnEnviar">
            <i class="fas fa-paper-plane"></i> Enviar Notifica√ß√£o
          </button>
        </div>
      </form>
    </section>
  </main>

  <!-- Toast de sucesso -->
  <div id="mensagemSucesso" class="alert" role="status" aria-live="polite">
    <span class="badge"><i class="fa-solid fa-check"></i> Enviado</span>
    <span>Notifica√ß√£o enviada com sucesso!</span>
    <a id="btnPdf" href="#" target="_blank"><i class="fas fa-file-pdf"></i> Baixar PDF</a>
  </div>

  <!-- üîµ Overlay de envio + barra de progresso -->
  <div id="overlayEnvio" class="overlay-envio" aria-hidden="true">
    <div class="overlay-card">
      <div class="overlay-title">
        <i class="fas fa-spinner fa-spin"></i>
        <span>Enviando notifica√ß√£o...</span>
      </div>
      <p class="overlay-text">
        Aguarde enquanto suas informa√ß√µes e fotos s√£o enviadas para o servidor.
        N√£o feche esta p√°gina.
      </p>
      <div class="progress-wrap">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div class="progress-percent" id="progressPercent">0%</div>
    </div>
  </div>

  <script>
    const form = document.getElementById('formNotificacao');
    const alertBox = document.getElementById('mensagemSucesso');
    const btnPdf = document.getElementById('btnPdf');

    const dropArea = document.getElementById('dropArea');
    const fileInput = document.getElementById('fotos');
    const fileInfo = document.getElementById('fileInfo');

    const botaoEnviar = document.getElementById('btnEnviar');

    const overlayEnvio = document.getElementById('overlayEnvio');
    const progressBar = document.getElementById('progressBar');
    const progressPercent = document.getElementById('progressPercent');

    // --------- Valida√ß√£o em tempo real ----------
    const camposObrigatorios = form.querySelectorAll('[required]');
    function marcarValidade(campo){
      const wrapper = campo.closest('.input') || campo.closest('.dropzone');
      if(!wrapper) return;
      if(!campo.value || (campo.type === 'file' && !campo.files.length)){
        wrapper.classList.add('input-error');
      }else{
        wrapper.classList.remove('input-error');
      }
    }
    camposObrigatorios.forEach(campo=>{
      campo.addEventListener('blur', ()=>marcarValidade(campo));
      campo.addEventListener('change', ()=>marcarValidade(campo));
      campo.addEventListener('input', ()=>marcarValidade(campo));
    });

    // --------- Submiss√£o com XHR + progresso ----------
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      // Valida√ß√£o HTML5 geral
      if(!form.checkValidity()){
        camposObrigatorios.forEach(marcarValidade);
        alert('Preencha todos os campos obrigat√≥rios.');
        return;
      }

      // Valida√ß√£o espec√≠fica das fotos
      if (!fileInput.files || fileInput.files.length === 0) {
        alert('Anexe ao menos 1 foto como evid√™ncia.');
        fileInput.focus();
        marcarValidade(fileInput);
        return;
      }

      const fd = new FormData(form);

      // Desabilita bot√£o + estado "Enviando..."
      botaoEnviar.disabled = true;
      botaoEnviar.style.opacity = "0.6";
      botaoEnviar.style.cursor = "not-allowed";
      botaoEnviar.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Enviando...`;

      // Mostra overlay
      overlayEnvio.classList.add('show');
      progressBar.style.width = '0%';
      progressPercent.textContent = '0%';

      const xhr = new XMLHttpRequest();
      xhr.open('POST', '/enviar');

      // Progresso do upload
      xhr.upload.onprogress = function(e){
        if(e.lengthComputable){
          const percent = Math.round((e.loaded / e.total) * 100);
          progressBar.style.width = percent + '%';
          progressPercent.textContent = percent + '%';
        }
      };

      xhr.onreadystatechange = function(){
        if(xhr.readyState === 4){
          // Esconde overlay
          overlayEnvio.classList.remove('show');

          if(xhr.status === 200){
            try{
              const data = JSON.parse(xhr.responseText);
              if(data && data._id){
                btnPdf.href = `/notificacoes/${data._id}/pdf`;
                alertBox.classList.add('show');
                setTimeout(() => alertBox.classList.remove('show'), 10000);
              }else{
                alert('Notifica√ß√£o enviada, mas n√£o foi poss√≠vel obter o ID para o PDF.');
              }
            }catch(err){
              alert('Erro ao processar resposta do servidor.');
            }
            // Mant√©m o bot√£o desabilitado (evita novo envio em cima do mesmo formul√°rio)
          }else{
            alert('Erro ao enviar notifica√ß√£o.');
            // Reabilita o bot√£o em caso de erro
            botaoEnviar.disabled = false;
            botaoEnviar.style.opacity = "1";
            botaoEnviar.style.cursor = "pointer";
            botaoEnviar.innerHTML = `<i class="fas fa-paper-plane"></i> Enviar Notifica√ß√£o`;
          }
        }
      };

      xhr.onerror = function(){
        overlayEnvio.classList.remove('show');
        alert('Erro de conex√£o ao enviar notifica√ß√£o.');
        botaoEnviar.disabled = false;
        botaoEnviar.style.opacity = "1";
        botaoEnviar.style.cursor = "pointer";
        botaoEnviar.innerHTML = `<i class="fas fa-paper-plane"></i> Enviar Notifica√ß√£o`;
      };

      xhr.send(fd);
    });

    // --------- Dropzone ----------
    const updateFileInfo = (files) => {
      if(!files || files.length === 0){ fileInfo.textContent = 'Nenhum arquivo selecionado'; return; }
      if(files.length === 1){ fileInfo.textContent = files[0].name; return; }
      fileInfo.textContent = `${files.length} arquivos selecionados`;
    };

    ['dragenter','dragover'].forEach(evt =>
      dropArea.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); dropArea.classList.add('dragover'); })
    );
    ['dragleave','drop'].forEach(evt =>
      dropArea.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); dropArea.classList.remove('dragover'); })
    );
    dropArea.addEventListener('drop', (e)=>{
      const files = e.dataTransfer.files;
      fileInput.files = files;
      updateFileInfo(files);
      marcarValidade(fileInput);
    });
    fileInput.addEventListener('change', (e)=> {
      updateFileInfo(e.target.files);
      marcarValidade(fileInput);
    });

    // --------- UX extra ----------
    const dataInput = document.getElementById('data');
    if(!dataInput.value){
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth()+1).padStart(2,'0');
      const dd = String(today.getDate()).padStart(2,'0');
      dataInput.value = `${yyyy}-${mm}-${dd}`;
    }
  </script>
</body>
</html>
