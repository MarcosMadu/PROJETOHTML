<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Checklist de Inspeção em Ativos</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 16px;
      display: flex;
      justify-content: center;
    }
    .back-container {
      position: fixed;
      top: 16px;
      left: 16px;
      z-index: 100;
    }
    .btn-back {
      display: inline-block;
      padding: 8px 12px;
      background: #2E7D32;
      color: #fff;
      border-radius: 4px;
      font-weight: 500;
      text-decoration: none;
      transition: background 0.2s;
      font-size: 0.9rem;
    }
    .btn-back:hover { background: #1b5e20; }

    .form-card {
      background: #fff;
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 800px;
    }
    h1 {
      text-align: center;
      margin-bottom: 24px;
      color: #2E7D32;
    }
    .field-group {
      margin-bottom: 16px;
    }
    .field-group label {
      display: block;
      font-weight: 500;
      margin-bottom: 6px;
      color: #333;
    }
    .field-group select,
    .field-group input[type=date],
    .field-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
    }
    .question {
      display: flex; flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
      border-bottom: 1px solid #eee;
      padding-bottom: 12px;
    }
    .question label {
      flex: 1 1 70%; font-weight: 500; color: #333; margin-right: 16px;
    }
    .options {
      display: flex; gap: 8px; flex: 1 1 25%; justify-content: flex-end;
    }
    .options button {
      background: none; border: none; font-size: 1.5rem;
      cursor: pointer; transition: transform .1s;
    }
    .options button.selected { transform: scale(1.3); }
    .photo-input {
      display: none; margin: 8px 0 16px 0; padding-left: 16px;
    }
    .photo-input label { font-weight: 500; }
    .photo-input input { margin-top: 6px; }
    button[type=submit] {
      width: 100%; padding: 14px; background: #2E7D32; color: #fff;
      border: none; border-radius: 6px; font-size: 1rem;
      cursor: pointer; transition: background .2s; margin-top: 24px;
    }
    button[type=submit]:hover { background: #1b5e20; }
    @media (max-width: 768px) {
      .question { flex-direction: column; align-items: flex-start; }
      .options { justify-content: flex-start; margin-top: 8px; }
    }
  </style>
</head>
<body>

  <div class="back-container">
    <a href="/dashboard.html" class="btn-back">← Voltar ao Painel Inicial</a>
  </div>

  <div class="form-card">
    <h1>Checklist de Inspeção em Ativos</h1>
    <form id="formInspecao">
      <!-- Campos iniciais -->
      <div class="field-group">
        <label for="funcionario">Funcionário:</label>
        <select id="funcionario" name="funcionario" required>
          <option value="">Selecione...</option>
          <option>Alvaro Moreira da Costa</option>
<option>Debora Nascimento de Freitas</option>
<option>Diego Silva da Silva</option>
<option>Douglas Leandro Silva Raposo</option>
<option>Elizete Francisca Pardim Messias</option>
<option>Fabricio Lopes das Neves</option>
<option>Jailton Pinto Pacheco Larroque</option>
<option>Jozivaldo Brito de Araujo</option>
<option>Marcos Augusto Mendonça Goncalves</option>
<option>Joelson De Sousa Amorim</option>
<option>Lorena Sampaio Sobral</option>
<option>Luis Fernando Barros Brandão</option>
<option>Luiz Carlos Ferreira Diniz</option>
<option>Thayllison da Silva Cunha</option>
<option>Rafael Silva Sousa</option>
<option>Edison Alexandrino da Silva</option>
<option>Thalia Maia Fernandes</option>
<option>Valmiran Eduardo Cardoso da Silva</option>
<option>Raimundo Nonato De Souza Vieira</option>

          <!-- demais opções... -->
        </select>
      </div>
      <div class="field-group">
        <label for="dataInspecao">Data da Inspeção:</label>
        <input type="date" id="dataInspecao" name="dataInspecao" required>
      </div>
      <div class="field-group">
        <label for="equipamento">Selecione o Equipamento/Veículo:</label>
        <select id="equipamento" name="equipamento" required>
          <option value="">Selecione...</option>
          <option>Retroescavadeira X</option>
          <option>Caminhão Y</option>
          <!-- demais equipamentos... -->
        </select>
      </div>

      <!-- Checklist de perguntas via script -->
      <script>
        const perguntas = [
          "Há leiras de proteção construídas com altura mínima correspondente à metade do diâmetro do maior pneu?",
          "Em áreas de lavra subterrânea, são adotados outros tipos de barreiras físicas?",
          "Todas as redes elétricas e tubulações em áreas de mineração estão devidamente sinalizadas?",
          "Condições de segurança (traves, limitadores) existem em equipamentos móveis?",
          "Barreiras físicas ou dispositivos de proteção segregam pessoas e equipamentos?",
          "É disponibilizado rádio bidirecional para sinalizadores?",
          "Os caminhões possuem caixa de câmbio sincronizada?",
          "Equipamentos com pontos de articulação possuem sinalização clara?",
          "Equipamentos com dispositivos de estabilização possuem acionamento hidráulico?",
          "Rampas de acesso possuem sistema eletro-hidráulico?",
          "Equipamentos possuem sinalização de capacidade máxima?",
          "É respeitada a proibição de uso sem cabine?",
          "Pontos de articulação têm sinalização de perigo?",
          "Dispositivos de estabilização possuem acionamento hidráulico?",
          "Rampas de acesso têm sistema eletro-hidráulico?",
          "Capacidade máxima de carga e tara está sinalizada?",
          "Existe sinalização externa de identificação à distância?",
          "Para-brisas são laminados ou homologados?",
          "Dispositivos para sinalização (triângulos, cones) existem?"
        ];

        const form = document.getElementById('formInspecao');
        perguntas.forEach((txt, i) => {
          const idx = i + 1;
          const divQ = document.createElement('div');
          divQ.className = 'question';
          divQ.dataset.question = idx;
          divQ.innerHTML = `
            <label>${idx}. ${txt}</label>
            <div class="options">
              <button type="button" class="opt" data-value="nao">❌</button>
              <button type="button" class="opt" data-value="sim">✅</button>
              <button type="button" class="opt" data-value="na">N/A</button>
            </div>
          `;
          form.appendChild(divQ);
          const divPhoto = document.createElement('div');
          divPhoto.className = 'photo-input';
          divPhoto.id = `photo-${idx}`;
          divPhoto.innerHTML = `
            <label>Anexe foto do desvio:</label>
            <input type="file" name="foto${idx}" accept="image/*">
          `;
          form.appendChild(divPhoto);
        });

        // campo extra
        const extra = document.createElement('div');
        extra.className = 'field-group';
        extra.innerHTML = `
          <label for="desvioExtra">Descreva qualquer desvio não listado (opcional):</label>
          <textarea id="desvioExtra" name="desvioExtra" rows="3"></textarea>
        `;
        form.appendChild(extra);

        // botão enviar
        const btn = document.createElement('button');
        btn.type = 'submit';
        btn.textContent = 'Enviar Inspeção';
        form.appendChild(btn);

        // interação seleção
        form.addEventListener('click', e => {
          if (e.target.classList.contains('opt')) {
            const btns = e.target.closest('.options').querySelectorAll('.opt');
            btns.forEach(b => b.classList.remove('selected'));
            e.target.classList.add('selected');
            const qid = e.target.closest('.question').dataset.question;
            document.getElementById(`photo-${qid}`).style.display =
              e.target.textContent === '❌' ? 'block' : 'none';
          }
        });

        // envio ajax
        form.addEventListener('submit', async e => {
          e.preventDefault();
          const fd = new FormData(form);
          document.querySelectorAll('.question').forEach(q => {
            const val = q.querySelector('.opt.selected')?.dataset.value || '';
            fd.append(`resposta${q.dataset.question}`, val);
          });
          const res = await fetch('/inspecao', { method: 'POST', body: fd });
          if (res.ok) {
            alert('Inspeção enviada com sucesso!');
            form.reset();
            document.querySelectorAll('.photo-input').forEach(d => d.style.display = 'none');
          } else {
            alert('Erro ao enviar inspeção.');
          }
        });
      </script>
    </form>
  </div>
</body>
</html>
